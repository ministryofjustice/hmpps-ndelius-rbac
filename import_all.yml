---

- name: Set facts
  set_fact:
    workspace: '/root/uplift/{{ ldap_config.rbac_version }}'
    ssm_prefix: '/{{ environment_name }}/{{ project_name }}/apacheds/apacheds/'

- name: Ensure LDAP service is running
  service:
    name: slapd
    state: started

- name: Create context entries
  include_tasks: create_context.yml

- name: Import policies
  include_tasks: import_policies.yml

- name: Import schemas
  include_tasks: import_schemas.yml

- name: Import roles
  include_tasks: import_roles.yml

- name: Import groups
  include_tasks: import_groups.yml

- name: Import users/clients
  include_tasks: import_users.yml

- name: Remove workspace
  file:
    path: '{{ workspace }}'
    state: absent